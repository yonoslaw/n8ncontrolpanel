<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turbo Prosty Config Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4">
        <header class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-bold">Turbo Prosty Config Panel</h1>
            <div class="flex gap-2">
                <div class="relative">
                    <select id="add-field-type" class="p-2 border rounded">
                        <option value="string">String</option>
                        <option value="bool">Boolean</option>
                        <option value="float">Float</option>
                        <option value="image">Image</option>
                    </select>
                    <button id="add-field-btn" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Dodaj pole</button>
                </div>
                <button id="export-json-btn" class="bg-green-500 text-white p-2 rounded hover:bg-green-600">Export JSON</button>
                <button id="import-json-btn" class="bg-yellow-500 text-white p-2 rounded hover:bg-yellow-600">Import JSON</button>
            </div>
        </header>

        <div id="fields-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Dynamic fields will be inserted here -->
        </div>
        
        <!-- Import Modal -->
        <div id="import-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center">
            <div class="bg-white p-6 rounded-lg shadow-lg w-1/3">
                <h2 class="text-xl font-bold mb-4">Import JSON</h2>
                <textarea id="json-import-area" class="w-full h-40 p-2 border rounded" placeholder="Wklej tutaj swój JSON..."></textarea>
                <div class="flex justify-end gap-2 mt-4">
                    <button id="cancel-import-btn" class="bg-gray-300 p-2 rounded">Anuluj</button>
                    <button id="confirm-import-btn" class="bg-blue-500 text-white p-2 rounded">Załaduj</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const fieldsContainer = document.getElementById('fields-container');
            const addFieldBtn = document.getElementById('add-field-btn');
            const addFieldType = document.getElementById('add-field-type');
            const exportJsonBtn = document.getElementById('export-json-btn');
            const importJsonBtn = document.getElementById('import-json-btn');
            const importModal = document.getElementById('import-modal');
            const jsonImportArea = document.getElementById('json-import-area');
            const cancelImportBtn = document.getElementById('cancel-import-btn');
            const confirmImportBtn = document.getElementById('confirm-import-btn');

            let fields = [];

            const saveState = () => {
                localStorage.setItem('configPanelState', JSON.stringify(fields));
            };

            const loadState = () => {
                const savedState = localStorage.getItem('configPanelState');
                if (savedState) {
                    fields = JSON.parse(savedState);
                    renderFields();
                }
            };

            const renderFields = () => {
                fieldsContainer.innerHTML = '';
                fields.forEach(field => {
                    const fieldWrapper = document.createElement('div');
                    fieldWrapper.className = 'bg-white p-4 rounded-lg shadow';
                    fieldWrapper.dataset.id = field.id;

                    let inputHtml = '';
                    switch (field.type) {
                        case 'string':
                            inputHtml = `<input type="text" value="${field.value}" data-key="value" class="w-full p-2 border rounded mt-2">`;
                            break;
                        case 'bool':
                            inputHtml = `<input type="checkbox" ${field.value ? 'checked' : ''} data-key="value" class="h-6 w-6 mt-2">`;
                            break;
                        case 'float':
                            inputHtml = `<input type="range" min="0" max="1" step="0.01" value="${field.value}" data-key="value" class="w-full mt-2">
                                         <span class="text-sm">${field.value}</span>`;
                            break;
                        case 'image':
                            inputHtml = `<input type="file" accept="image/*" data-key="value" class="w-full mt-2">
                                         ${field.value ? `<img src="${field.value}" class="mt-2 max-h-32">` : ''}`;
                            break;
                    }

                    fieldWrapper.innerHTML = `
                        <div class="flex justify-between items-center">
                            <input type="text" value="${field.name}" data-key="name" class="text-lg font-bold w-full mr-2" placeholder="Nazwa pola...">
                            <button data-action="delete" class="text-red-500 hover:text-red-700">Usuń</button>
                        </div>
                        ${inputHtml}
                    `;
                    fieldsContainer.appendChild(fieldWrapper);
                });
                saveState();
            };

            const getFieldById = (id) => fields.find(f => f.id === id);

            fieldsContainer.addEventListener('input', (e) => {
                const target = e.target;
                const fieldId = target.closest('[data-id]').dataset.id;
                const field = getFieldById(fieldId);
                const key = target.dataset.key;

                if (!field || !key) return;

                if (field.type === 'bool' && key === 'value') {
                    field.value = target.checked;
                } else if (field.type === 'image' && key === 'value') {
                    const file = target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            field.value = event.target.result;
                            renderFields(); // Re-render to show image preview
                        };
                        reader.readAsDataURL(file);
                    }
                } else {
                    field[key] = target.value;
                }
                
                // Update float value display
                if (field.type === 'float' && key === 'value') {
                    target.nextElementSibling.textContent = target.value;
                }

                saveState();
            });

            fieldsContainer.addEventListener('click', (e) => {
                if (e.target.dataset.action === 'delete') {
                    const fieldId = e.target.closest('[data-id]').dataset.id;
                    fields = fields.filter(f => f.id !== fieldId);
                    renderFields();
                }
            });

            addFieldBtn.addEventListener('click', () => {
                const newField = {
                    id: Date.now().toString(),
                    type: addFieldType.value,
                    name: 'Nowe Pole',
                    value: ''
                };
                switch (newField.type) {
                    case 'string': newField.value = ''; break;
                    case 'bool': newField.value = false; break;
                    case 'float': newField.value = 0.5; break;
                    case 'image': newField.value = null; break;
                }
                fields.push(newField);
                renderFields();
            });

            exportJsonBtn.addEventListener('click', () => {
                const jsonString = JSON.stringify({ fields }, null, 2);
                navigator.clipboard.writeText(jsonString).then(() => {
                    alert('JSON skopiowany do schowka!');
                }).catch(err => {
                    console.error('Błąd kopiowania JSON: ', err);
                    alert('Nie udało się skopiować JSON.');
                });
            });

            importJsonBtn.addEventListener('click', () => {
                importModal.classList.remove('hidden');
                importModal.classList.add('flex');
            });

            cancelImportBtn.addEventListener('click', () => {
                importModal.classList.add('hidden');
                importModal.classList.remove('flex');
            });

            confirmImportBtn.addEventListener('click', () => {
                try {
                    const data = JSON.parse(jsonImportArea.value);
                    if (data && Array.isArray(data.fields)) {
                        fields = data.fields;
                        renderFields();
                        importModal.classList.add('hidden');
                        importModal.classList.remove('flex');
                        jsonImportArea.value = '';
                    } else {
                        alert('Nieprawidłowy format JSON. Oczekiwano obiektu z kluczem "fields".');
                    }
                } catch (error) {
                    alert('Błąd parsowania JSON. Sprawdź poprawność danych.');
                    console.error('Błąd importu JSON:', error);
                }
            });

            // Initial load
            loadState();
        });
    </script>

</body>
</html>
